<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
Â  Â  <title>Alky</title>
Â  Â Â 
Â  Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
Â  Â  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

Â  Â  <style>
Â  Â  Â  Â  :root { --accent: #ff4d4d; --soft: #888; --border: #eeeeee; }
Â  Â  Â  Â  body { font-family: -apple-system, sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; background: #fff; color: #1a1a1a; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #header { text-align: center; padding-top: 40px; width: 100%; background: #fff; }
Â  Â  Â  Â  #day-counter { font-size: 0.7rem; letter-spacing: 2px; color: var(--soft); font-weight: bold; text-transform: uppercase; }
Â  Â  Â  Â  .heart-pulse { display: inline-block; color: var(--accent); font-size: 1.1rem; animation: heartBeat 1.2s infinite; cursor: pointer; }
Â  Â  Â  Â  @keyframes heartBeat { 0% { transform: scale(1); } 14% { transform: scale(1.3); } 28% { transform: scale(1); } 42% { transform: scale(1.3); } 70% { transform: scale(1); } }

Â  Â  Â  Â  #db-status { font-size: 0.5rem; margin-top: 5px; color: orange; font-weight: bold; }

Â  Â  Â  Â  .section { width: 100%; max-width: 400px; margin-top: 20px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .mood-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
Â  Â  Â  Â  .mood-box { border: 1px solid var(--border); padding: 12px; text-align: center; border-radius: 12px; cursor: pointer; background: #fff; transition: 0.2s; }
Â  Â  Â  Â  .mood-box:active { background: #f0f0f0; }
Â  Â  Â  Â  .mood-box span { font-size: 1.4rem; display: block; }
Â  Â  Â  Â  .mood-box p { margin: 4px 0 0 0; font-size: 0.55rem; color: var(--soft); font-weight: bold; text-transform: uppercase; }

Â  Â  Â  Â  #viewport { width: 100%; aspect-ratio: 1/1; border: 1px solid var(--border); background: #f9f9f9; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; border-radius: 15px; margin-top: 15px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* UPDATED: Force no mirroring in preview */
Â  Â  Â  Â  video, #preview-img {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  object-fit: cover;Â 
Â  Â  Â  Â  Â  Â  transform: scaleX(1) !important;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  .cam-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
Â  Â  Â  Â  .btn { padding: 12px; border: 1px solid #000; background: #fff; font-size: 0.7rem; cursor: pointer; text-transform: uppercase; font-weight: bold; border-radius: 10px; }
Â  Â  Â  Â  .btn-black { background: #000; color: #fff; width: 100%; margin-top: 10px; }

Â  Â  Â  Â  textarea { width: 100%; border: none; border-bottom: 2px solid var(--border); margin: 10px 0; padding: 10px 0; outline: none; font-size: 1rem; box-sizing: border-box; }

Â  Â  Â  Â  #timeline { width: 100%; max-width: 400px; margin-top: 30px; border-top: 2px solid #f0f0f0; padding-top: 20px; }
Â  Â  Â  Â  .entry { margin-bottom: 30px; padding: 15px; border-radius: 15px; background: #fff; border: 1px solid #f0f0f0; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
Â  Â  Â  Â  .entry-img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
Â  Â  Â  Â  .author-tag { font-weight: 800; font-size: 0.75rem; color: var(--accent); margin-bottom: 5px; display: block; }
Â  Â  Â  Â  .comment-item { font-size: 0.8rem; padding: 5px; border-top: 1px solid #eee; margin-top: 5px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #toast { position: fixed; top: 20px; background: #333; color: #fff; padding: 8px 16px; border-radius: 20px; font-size: 0.7rem; display: none; z-index: 10000; }
Â  Â  </style>
</head>
<body>

<div id="toast">Update Sent</div>

<div id="header">
Â  Â  <div id="day-counter">Day Counter <span class="heart-pulse" onclick="iamHere()">â™¥</span></div>
Â  Â  <div id="db-status">Checking Connection...</div>
Â  Â  <div style="font-size: 0.5rem; color: #bbb; cursor: pointer; margin-top: 5px;" onclick="resetIdentity()">Settings</div>
</div>

<div class="section">
Â  Â  <div class="mood-grid">
Â  Â  Â  Â  <div class="mood-box" onclick="quickLog('ğŸ˜Š', 'Happy')"><span>ğŸ˜Š</span><p>Happy</p></div>
Â  Â  Â  Â  <div class="mood-box" onclick="quickLog('ğŸ˜¤', 'Mad')"><span>ğŸ˜¤</span><p>Mad</p></div>
Â  Â  Â  Â  <div class="mood-box" onclick="quickLog('â˜ï¸', 'Sad')"><span>â˜ï¸</span><p>Sad</p></div>
Â  Â  Â  Â  <div class="mood-box" onclick="quickLog('ğŸ«‚', 'Miss You')"><span>ğŸ«‚</span><p>Miss You</p></div>
Â  Â  Â  Â  <div class="mood-box" onclick="quickLog('ğŸ§˜', 'Space')"><span>ğŸ§˜</span><p>Space</p></div>
Â  Â  Â  Â  <div class="mood-box" onclick="quickLog('ğŸ’¬', 'Talk')"><span>ğŸ’¬</span><p>Talk</p></div>
Â  Â  </div>
</div>

<div class="section">
Â  Â  <div id="viewport">
Â  Â  Â  Â  <video id="v" autoplay playsinline muted style="display:none;"></video>
Â  Â  Â  Â  <img id="preview-img" style="display:none;">
Â  Â  Â  Â  <span id="cam-label" style="font-size: 0.6rem; color: #999;">CAMERA READY</span>
Â  Â  </div>
Â  Â  <div class="cam-controls">
Â  Â  Â  Â  <button class="btn" id="open-btn" onclick="startCamera('user')" style="grid-column: span 2;">Camera</button>
Â  Â  Â  Â  <button id="snap-btn" class="btn" style="display:none; background: #000; color: #fff;" onclick="takePhoto()">Snap</button>
Â  Â  Â  Â  <button id="flip-btn" class="btn" style="display:none;" onclick="flipCamera()">Flip</button>
Â  Â  Â  Â  <button id="close-btn" class="btn" style="display:none; grid-column: span 2;" onclick="stopCamera()">Cancel</button>
Â  Â  </div>
Â  Â  <textarea id="msg-input" placeholder="Add a caption..."></textarea>
Â  Â  <button class="btn btn-black" onclick="postNow()">Post Entry</button>
</div>

<div id="timeline">
Â  Â  <div id="list" style="text-align: center; color: #bbb; font-size: 0.8rem;">Searching for memories...</div>
</div>

<script>
Â  Â  const firebaseConfig = { databaseURL: "https://alky-bd03f-default-rtdb.asia-southeast1.firebasedatabase.app/" };
Â  Â  firebase.initializeApp(firebaseConfig);
Â  Â  const db = firebase.database().ref('alky_v4_final');Â 

Â  Â  let userRole = localStorage.getItem('alky_user');
Â  Â  if (!userRole) {
Â  Â  Â  Â  userRole = confirm("Is this CD?") ? 'CD' : 'Nadine';
Â  Â  Â  Â  localStorage.setItem('alky_user', userRole);
Â  Â  }

Â  Â  const statusEl = document.getElementById('db-status');
Â  Â  firebase.database().ref(".info/connected").on("value", (snap) => {
Â  Â  Â  Â  if (snap.val() === true) {
Â  Â  Â  Â  Â  Â  statusEl.innerText = "â— ONLINE & SYNCED";
Â  Â  Â  Â  Â  Â  statusEl.style.color = "green";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  statusEl.innerText = "â— OFFLINE - CHECK INTERNET";
Â  Â  Â  Â  Â  Â  statusEl.style.color = "red";
Â  Â  Â  Â  }
Â  Â  });

Â  Â  db.on('value', (snapshot) => {
Â  Â  Â  Â  const list = document.getElementById('list');
Â  Â  Â  Â  const data = snapshot.val();
Â  Â  Â  Â  if(!data) {
Â  Â  Â  Â  Â  Â  list.innerHTML = "No posts yet. Be the first!";
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  Object.keys(data).reverse().forEach(key => {
Â  Â  Â  Â  Â  Â  const item = data[key];
Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  div.className = 'entry';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let replies = '';
Â  Â  Â  Â  Â  Â  if(item.replies) {
Â  Â  Â  Â  Â  Â  Â  Â  Object.values(item.replies).forEach(r => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  replies += `<div class="comment-item"><b>${r.by}:</b> ${r.text}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <span class="author-tag">${item.author}</span>
Â  Â  Â  Â  Â  Â  Â  Â  ${item.image ? `<img src="${item.image}" class="entry-img">` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: 500;">${item.mood ? item.mood + ' ' : ''}${item.text || ''}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.6rem; color:#bbb; margin-top:8px;">${item.time}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <button style="border:none; background:none; color:#007aff; font-size:0.7rem; font-weight:bold; cursor:pointer; margin-top:10px;" onclick="addReply('${key}')">Reply</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="replies-${key}">${replies}</div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  list.appendChild(div);
Â  Â  Â  Â  });
Â  Â  });

Â  Â  function postNow() {
Â  Â  Â  Â  const txt = document.getElementById('msg-input').value;
Â  Â  Â  Â  const img = capturedImg;
Â  Â  Â  Â  if(!txt && !img) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  db.push({
Â  Â  Â  Â  Â  Â  author: userRole,
Â  Â  Â  Â  Â  Â  text: txt,
Â  Â  Â  Â  Â  Â  image: img,
Â  Â  Â  Â  Â  Â  time: new Date().toLocaleString(),
Â  Â  Â  Â  Â  Â  timestamp: Date.now()
Â  Â  Â  Â  }).then(() => {
Â  Â  Â  Â  Â  Â  document.getElementById('msg-input').value = "";
Â  Â  Â  Â  Â  Â  stopCamera();
Â  Â  Â  Â  Â  Â  capturedImg = null;
Â  Â  Â  Â  Â  Â  document.getElementById('preview-img').style.display='none';
Â  Â  Â  Â  Â  Â  showToast("Post Shared!");
Â  Â  Â  Â  }).catch(e => alert("Error: Post failed."));
Â  Â  }

Â  Â  function quickLog(emoji, label) {
Â  Â  Â  Â  db.push({ mood: emoji, text: label, author: userRole, time: new Date().toLocaleString() });
Â  Â  Â  Â  showToast(emoji + " Logged");
Â  Â  }

Â  Â  function addReply(id) {
Â  Â  Â  Â  const r = prompt("Reply:");
Â  Â  Â  Â  if(!r) return;
Â  Â  Â  Â  db.child(id).child('replies').push({ by: userRole, text: r });
Â  Â  }

Â  Â  function showToast(m) {
Â  Â  Â  Â  const t = document.getElementById('toast');
Â  Â  Â  Â  t.innerText = m; t.style.display = 'block';
Â  Â  Â  Â  setTimeout(()=> t.style.display='none', 2000);
Â  Â  }

Â  Â  const v = document.getElementById('v');
Â  Â  const preview = document.getElementById('preview-img');
Â  Â  let stream = null; let capturedImg = null; let mode = "user";

Â  Â  async function startCamera(m) {
Â  Â  Â  Â  if(stream) stopCamera();
Â  Â  Â  Â  mode = m;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: mode } });
Â  Â  Â  Â  Â  Â  v.srcObject = stream; v.style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('cam-label').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('open-btn').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('snap-btn').style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('flip-btn').style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('close-btn').style.display = 'block';
Â  Â  Â  Â  } catch(e) { alert("Camera Error"); }
Â  Â  }

Â  Â  function flipCamera() { startCamera(mode === "user" ? "environment" : "user"); }

Â  Â  function stopCamera() {
Â  Â  Â  Â  if(stream) stream.getTracks().forEach(t => t.stop());
Â  Â  Â  Â  v.style.display = 'none';Â 
Â  Â  Â  Â  document.getElementById('cam-label').style.display = 'block';
Â  Â  Â  Â  document.getElementById('open-btn').style.display = 'block';
Â  Â  Â  Â  document.getElementById('snap-btn').style.display = 'none';Â 
Â  Â  Â  Â  document.getElementById('flip-btn').style.display = 'none';
Â  Â  Â  Â  document.getElementById('close-btn').style.display = 'none';
Â  Â  }

Â  Â  function takePhoto() {
Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  canvas.width = v.videoWidth;Â 
Â  Â  Â  Â  canvas.height = v.videoHeight;
Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // UPDATED: No flipping code here. Just draw as is.
Â  Â  Â  Â  ctx.drawImage(v, 0, 0);
Â  Â  Â  Â Â 
Â  Â  Â  Â  capturedImg = canvas.toDataURL('image/jpeg', 0.5);
Â  Â  Â  Â  preview.src = capturedImg;Â 
Â  Â  Â  Â  preview.style.display = 'block';
Â  Â  Â  Â  stopCamera();
Â  Â  }

Â  Â  function resetIdentity() { localStorage.removeItem('alky_user'); location.reload(); }
Â  Â Â 
Â  Â  const diff = Math.floor((new Date() - new Date("2025-08-12")) / (1000 * 60 * 60 * 24)) + 1;
Â  Â  document.getElementById('day-counter').innerHTML = `Day ${diff} of Us <span class="heart-pulse" onclick="iamHere()">â™¥</span>`;
</script>
</body>
</html>
