<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Connection Hub</title>
    <style>
        :root { --bg: #ffffff; --text: #1a1a1a; --border: #eeeeee; --soft: #888; --heart-color: #ff4d4d; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* Distance Header */
        #header { text-align: center; margin-bottom: 30px; }
        #day-counter { font-size: 0.65rem; letter-spacing: 3px; color: var(--soft); text-transform: uppercase; }
        #daily-prompt { font-size: 0.85rem; margin-top: 8px; font-style: italic; color: #555; max-width: 300px; }

        .section { width: 100%; max-width: 400px; margin-bottom: 30px; }
        h2 { font-weight: 400; font-size: 0.7rem; text-align: center; letter-spacing: 2px; color: var(--soft); text-transform: uppercase; margin-bottom: 15px; }

        /* Mood Grid */
        .mood-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .mood-box { border: 1px solid var(--border); padding: 15px; text-align: center; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .mood-box:active { background: #f0f0f0; transform: scale(0.95); }

        /* Camera Viewport */
        #viewport { width: 100%; aspect-ratio: 1/1; border: 1px solid var(--border); background: #000; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; border-radius: 4px; }
        video { width: 100%; height: 100%; object-fit: cover; display: none; transform: scaleX(-1); }
        #preview-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        
        /* Heart Pulse Animation */
        #pulse-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.9); display: none; 
            align-items: center; justify-content: center; z-index: 100; 
        }
        .big-heart { font-size: 8rem; animation: heartbeat 0.8s infinite; }
        @keyframes heartbeat { 
            0% { transform: scale(1); } 
            50% { transform: scale(1.3); } 
            100% { transform: scale(1); } 
        }

        .btn { width: 100%; padding: 14px; margin-top: 10px; border: 1px solid var(--text); background: #fff; font-size: 0.75rem; cursor: pointer; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
        .btn-black { background: #000; color: #fff; }
        .btn-pulse { border: none; color: var(--soft); font-size: 0.65rem; margin-top: 40px; }

        textarea { width: 100%; border: none; border-bottom: 1px solid var(--border); margin-top: 15px; padding: 12px 0; outline: none; font-family: inherit; font-size: 1rem; box-sizing: border-box; }

        /* Timeline */
        #timeline { width: 100%; max-width: 400px; margin-top: 40px; border-top: 1px solid var(--border); padding-top: 20px; }
        .entry { margin-bottom: 35px; position: relative; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .entry-img { width: 100%; border-radius: 4px; margin-bottom: 12px; border: 1px solid #eee; }
        .del-btn { position: absolute; right: 0; top: 0; background: none; border: none; color: #ccc; cursor: pointer; font-size: 1.2rem; }

        .entry-footer { display: flex; align-items: flex-start; gap: 12px; padding-right: 25px; }
        .entry-mood { font-size: 1.4rem; }
        .entry-text { font-size: 0.95rem; color: #333; line-height: 1.4; flex: 1; }
        .entry-time { font-size: 0.7rem; color: #bbb; margin-top: 4px; display: block; }
    </style>
</head>
<body>

    <div id="header">
        <div id="day-counter">Day 1 of our story</div>
        <div id="daily-prompt">‚ÄúSend a photo of something that reminds you of her.‚Äù</div>
    </div>

    <div class="section">
        <h2>How are you feeling?</h2>
        <div class="mood-grid">
            <div class="mood-box" onclick="quickLog('üòä', 'feeling happy')"><span>üòä</span><p>Happy</p></div>
            <div class="mood-box" onclick="quickLog('üò§', 'feeling mad')"><span>üò§</span><p>Mad</p></div>
            <div class="mood-box" onclick="quickLog('‚òÅÔ∏è', 'feeling sad')"><span>‚òÅÔ∏è</span><p>Sad</p></div>
            <div class="mood-box" onclick="quickLog('ü´Ç', 'missing you')"><span>ü´Ç</span><p>Miss You</p></div>
            <div class="mood-box" onclick="quickLog('üßò', 'needs space')"><span>üßò</span><p>Space</p></div>
            <div class="mood-box" onclick="quickLog('üí¨', 'wants to talk')"><span>üí¨</span><p>Talk</p></div>
        </div>
    </div>

    <div class="section">
        <div id="viewport">
            <video id="v" autoplay playsinline muted></video>
            <img id="preview-img" style="display:none; width:100%; height:100%; object-fit:cover;">
            <span id="cam-label" style="color:#666; font-size:0.7rem;">CAMERA IDLE</span>
        </div>
        <button class="btn" id="cam-toggle" onclick="toggleCamera()">Open Camera</button>
        <button id="snap-btn" class="btn btn-black" style="display:none;" onclick="captureImage()">Capture Photo</button>
        <textarea id="msg-input" placeholder="Write a message..."></textarea>
        <button class="btn btn-black" onclick="submitEntry()">Add to Timeline</button>
    </div>

    <div id="timeline"><div id="list"></div></div>

    <button class="btn btn-pulse" onclick="triggerHeart()">Click to send a silent "Thinking of you" heart</button>

    <div id="pulse-overlay"><div class="big-heart">‚ù§Ô∏è</div></div>

    <script>
        // --- 1. CONFIGURATION ---
        const startDate = new Date("2024-01-01"); // Change this to your actual start date!
        const prompts = [
            "What's one thing you want to do together this weekend?",
            "Send a photo of something that reminds you of her.",
            "What was the best part of today?",
            "Write a one-sentence apology or appreciation.",
            "If you could be anywhere right now, where would it be?",
            "What song are you listening to?"
        ];

        // --- 2. INITIALIZATION ---
        const v = document.getElementById('v');
        const previewImg = document.getElementById('preview-img');
        const list = document.getElementById('list');
        let stream = null;
        let capturedBase64 = null;

        window.onload = () => {
            // Update Day Counter
            const today = new Date();
            const diff = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            document.getElementById('day-counter').innerText = `Day ${diff} of Us`;
            
            // Random Daily Prompt
            document.getElementById('daily-prompt').innerText = `‚Äú${prompts[Math.floor(Math.random() * prompts.length)]}‚Äù`;
            
            loadHistory();
        };

        // --- 3. HEART PULSE ---
        function triggerHeart() {
            const overlay = document.getElementById('pulse-overlay');
            overlay.style.display = 'flex';
            setTimeout(() => { overlay.style.display = 'none'; }, 2500);
        }

        // --- 4. CAMERA & TIMELINE LOGIC ---
        async function toggleCamera() {
            if (stream) { stopCamera(); return; }
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                v.srcObject = stream; v.style.display = 'block'; previewImg.style.display = 'none';
                document.getElementById('cam-label').style.display = 'none';
                document.getElementById('snap-btn').style.display = 'block';
                document.getElementById('cam-toggle').innerText = "Stop Camera";
            } catch (err) { alert("Camera access denied."); }
        }

        function stopCamera() {
            if (stream) stream.getTracks().forEach(t => t.stop());
            stream = null; v.style.display = 'none';
            document.getElementById('snap-btn').style.display = 'none';
            document.getElementById('cam-toggle').innerText = "Open Camera";
            document.getElementById('cam-label').style.display = 'block';
        }

        function captureImage() {
            const canvas = document.createElement('canvas');
            canvas.width = v.videoWidth; canvas.height = v.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.translate(canvas.width, 0); ctx.scale(-1, 1);
            ctx.drawImage(v, 0, 0);
            capturedBase64 = canvas.toDataURL('image/jpeg', 0.8);
            previewImg.src = capturedBase64; previewImg.style.display = 'block';
            stopCamera();
        }

        function quickLog(emoji, text) { saveData({ mood: emoji, text: text, img: null }); }

        function submitEntry() {
            const text = document.getElementById('msg-input').value;
            if (!text && !capturedBase64) return;
            saveData({ mood: 'üíå', text: text, img: capturedBase64 });
            document.getElementById('msg-input').value = "";
            previewImg.style.display = 'none'; capturedBase64 = null;
        }

        function saveData(data) {
            const newItem = { ...data, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) + ' ‚Ä¢ ' + new Date().toLocaleDateString([], { month: 'short', day: 'numeric' }), id: Date.now() };
            const history = JSON.parse(localStorage.getItem('bridge_v3') || '[]');
            history.unshift(newItem);
            localStorage.setItem('bridge_v3', JSON.stringify(history));
            loadHistory();
        }

        function deleteEntry(id) {
            if (confirm("Delete this memory?")) {
                let history = JSON.parse(localStorage.getItem('bridge_v3') || '[]');
                history = history.filter(item => item.id !== id);
                localStorage.setItem('bridge_v3', JSON.stringify(history));
                loadHistory();
            }
        }

        function loadHistory() {
            list.innerHTML = '';
            const saved = JSON.parse(localStorage.getItem('bridge_v3') || '[]');
            saved.forEach(item => {
                const div = document.createElement('div');
                div.className = 'entry';
                div.innerHTML = `<button class="del-btn" onclick="deleteEntry(${item.id})">√ó</button>
                    ${item.img ? `<img src="${item.img}" class="entry-img">` : ''}
                    <div class="entry-footer">
                        <div class="entry-mood">${item.mood}</div>
                        <div class="entry-text">${item.text}<span class="entry-time">${item.time}</span></div>
                    </div>`;
                list.appendChild(div);
            });
        }
    </script>
</body>
</html>
