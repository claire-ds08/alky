<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Hub</title>
    <style>
        :root { --bg: #ffffff; --text: #1a1a1a; --border: #eeeeee; --soft: #888; --accent: #000; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .main-card { width: 100%; max-width: 400px; margin-top: 20px; }
        h2 { font-weight: 300; font-size: 1rem; text-align: center; letter-spacing: 2px; color: var(--soft); margin-bottom: 30px; }

        /* Viewport */
        #display-container {
            width: 100%; aspect-ratio: 1/1; border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            background: #fafafa; position: relative; overflow: hidden;
        }
        video, #preview-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        #prompt { font-size: 0.8rem; color: #ccc; }
        
        /* Mood Selector */
        .mood-selector { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        .mood-btn { 
            font-size: 1.2rem; cursor: pointer; filter: grayscale(1); 
            opacity: 0.4; transition: 0.3s; padding: 5px; border-radius: 50%;
        }
        .mood-btn.active { filter: grayscale(0); opacity: 1; background: #f9f9f9; }

        .action-bar { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .icon-btn { cursor: pointer; font-size: 0.75rem; color: var(--soft); text-transform: uppercase; }
        .icon-btn:hover { color: #000; }

        textarea {
            width: 100%; border: none; border-bottom: 1px solid var(--border);
            margin-top: 20px; font-family: inherit; font-size: 0.95rem;
            resize: none; outline: none; padding: 10px 0; box-sizing: border-box;
        }
        .send-btn {
            width: 100%; margin-top: 20px; padding: 15px; background: var(--accent);
            color: #fff; border: none; cursor: pointer; font-size: 0.8rem; letter-spacing: 2px;
        }

        /* History */
        #history { width: 100%; max-width: 400px; margin-top: 50px; border-top: 1px solid var(--border); padding-top: 30px; }
        .history-item { margin-bottom: 40px; position: relative; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .history-img { width: 100%; border-radius: 2px; }
        .history-content { display: flex; align-items: flex-start; gap: 10px; margin-top: 12px; }
        .history-mood { font-size: 1.2rem; }
        .history-text { font-size: 0.9rem; line-height: 1.5; color: #333; flex: 1; }
        .history-date { font-size: 0.7rem; color: #bbb; margin-top: 8px; }
    </style>
</head>
<body>

    <div class="main-card">
        <h2>DAILY CONNECTION</h2>

        <div id="display-container">
            <span id="prompt">Camera or Upload</span>
            <video id="webcam" autoplay playsinline></video>
            <img id="preview-img">
        </div>

        <div class="mood-selector">
            <span class="mood-btn" onclick="setMood('ü§ç', this)">ü§ç</span>
            <span class="mood-btn" onclick="setMood('üå∏', this)">üå∏</span>
            <span class="mood-btn" onclick="setMood('üåä', this)">üåä</span>
            <span class="mood-btn" onclick="setMood('üåô', this)">üåô</span>
            <span class="mood-btn" onclick="setMood('‚òï', this)">‚òï</span>
        </div>

        <div class="action-bar">
            <span class="icon-btn" onclick="startCamera()">Camera</span>
            <span class="icon-btn" onclick="document.getElementById('file-in').click()">Upload</span>
            <span id="snap-btn" class="icon-btn" style="display:none; color:red;" onclick="takeSnap()">‚óè Snap</span>
        </div>

        <input type="file" id="file-in" hidden accept="image/*" onchange="handleFile(event)">
        <textarea id="msg-input" placeholder="What's on your mind?"></textarea>
        <button class="send-btn" onclick="saveToHistory()">POST TO TIMELINE</button>
    </div>

    <div id="history">
        <div id="history-list"></div>
    </div>

    <script>
        const video = document.getElementById('webcam');
        const previewImg = document.getElementById('preview-img');
        const snapBtn = document.getElementById('snap-btn');
        let stream = null;
        let selectedMood = "ü§ç";

        // Load History on Start
        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('connection_history') || '[]');
            saved.forEach(item => renderItem(item));
        };

        function setMood(mood, btn) {
            selectedMood = mood;
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        async function startCamera() {
            stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            video.style.display = 'block';
            previewImg.style.display = 'none';
            snapBtn.style.display = 'inline';
        }

        function takeSnap() {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            previewImg.src = canvas.toDataURL('image/png');
            previewImg.style.display = 'block';
            video.style.display = 'none';
            snapBtn.style.display = 'none';
            if (stream) stream.getTracks().forEach(t => t.stop());
        }

        function handleFile(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                previewImg.src = event.target.result;
                previewImg.style.display = 'block';
                video.style.display = 'none';
            };
            reader.readAsDataURL(e.target.files[0]);
        }

        function saveToHistory() {
            const msg = document.getElementById('msg-input').value;
            const img = previewImg.src;
            if (!msg && !img) return;

            const newItem = {
                id: Date.now(),
                mood: selectedMood,
                text: msg,
                image: img.startsWith('data') ? img : null,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })
            };

            const saved = JSON.parse(localStorage.getItem('connection_history') || '[]');
            saved.unshift(newItem);
            localStorage.setItem('connection_history', JSON.stringify(saved));

            renderItem(newItem, true);
            document.getElementById('msg-input').value = "";
            previewImg.style.display = 'none';
            previewImg.src = "";
        }

        function renderItem(item, isNew = false) {
            const list = document.getElementById('history-list');
            const div = document.createElement('div');
            div.className = 'history-item';
            div.innerHTML = `
                ${item.image ? `<img src="${item.image}" class="history-img">` : ''}
                <div class="history-content">
                    <div class="history-mood">${item.mood}</div>
                    <div class="history-text">${item.text}</div>
                </div>
                <div class="history-date">${item.date}</div>
            `;
            if (isNew) list.prepend(div); else list.appendChild(div);
        }
    </script>
</body>
</html>
